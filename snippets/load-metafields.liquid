{% comment %} V 2.0.0 {% endcomment %}
{% unless request.design_mode %}
    {% assign metafields = shop.metafields.bc_cookie %}

    {% assign data = null -%}
    {%- if shop.metafields.bc_cookie.value == blank -%}
      {%- assign data = shop.metafields.bc_cookie -%}
    {%- else -%}
      {%- assign data = shop.metafields.bc_cookie.value -%}
    {%- endif %}

    {% assign bc_cookie_list = null -%}
    {%- if data.bc_cookie_list.value == blank -%}
      {%- assign bc_cookie_list = data.bc_cookie_list -%}
    {%- else -%}
      {%- assign bc_cookie_list = data.bc_cookie_list.value -%}
    {%- endif %}

    {% if data.size > 0 and bc_cookie_list._bc_c_set.live == '1' and content_for_header contains 'beeclever.app\/get-script.php' %}
        <link rel="preconnect" href="https://gdpr-legal-cookie.beeclever.app">
        <link rel="preload" as="script" href="https://gdpr-legal-cookie.beeclever.app/get-script.php?shop={{ shop.permanent_domain }}">    <script>
            var sDomain = location.host;

            /****** Start thirdPartyScriptDefinition ******/

            var klaviyoDeclaration=2; // 1 => Statistik, 2 => Marketing
            window.thirdPartyScriptDefinition.push({
                    "src" : "klaviyo",
                    "cookie" : "_hp2_id.XXX",
                    "provider" : "klaviyo.com",
                    "description" : "",
                    "expires" : 33696000,
                    "domain" : "klaviyo.com",
                    "declaration" : 1,
                    "group" : "klaviyo"
                },{
                    "src" : "klaviyo",
                    "cookie" : "_hp2_ses_props.XXX",
                    "provider" : "klaviyo.com",
                    "description" : "",
                    "expires" : 1,
                    "domain" : "klaviyo.com",
                    "declaration" : 1,
                    "group" : "klaviyo"
                },{
                    "src" : "klaviyo",
                    "cookie" : "_gid",
                    "provider" : "klaviyo.com",
                    "description" : "",
                    "expires" : 86400,
                    "domain" : "klaviyo.com",
                    "declaration" : 1,
                    "group" : "klaviyo"
                },{
                    "src" : "klaviyo",
                    "cookie" : "__kla_id",
                    "provider" : "klaviyo.com",
                    "description" : "",
                    "expires" : 33696000,
                    "domain" : sDomain,
                    "declaration" : 1,
                    "group" : "klaviyo"
                },{
                    "src" : "klaviyo",
                    "cookie" : "KL_FORMS_MODAL",
                    "provider" : "klaviyo.com",
                    "description" : "",
                    "expires" : 0,
                    "domain" : sDomain,
                    "declaration" : 1,
                    "group" : "klaviyo"
                });

          
            (function(){
                  window.thirdPartyScriptDefinition = [
                      {% comment %}
                      /* start example

                    {
                          "src" : "facebook",
                          "cookie" : "fr",
                          "provider" : "facebook.com",
                        "description" : "",
                          "expires" : 7776000,
                          "domain" : "facebook.com",
                        "declaration" : 1,
                          "group" : "facebook"
                      },{
                          "src" : "facebook",
                          "cookie" : "_fbp",
                          "provider" : sDomain,
                        "description" : "",
                          "expires" : 7776000,
                        "domain" : sDomain,
                        "declaration" : 1,
                          "group" : "facebook"
                    }

                      end example */
                      {% endcomment %}
                  ]
              })();
              /****** End thirdPartyScriptDefinition ******/

              {% render 'zload-metafields' %}

        window.thirdPartyScriptDefinition.push(
                { "src" : "analytics.js", "cookie" : "_shopify_fs", "provider" : "shopify.com", "description" : "", "expires" : 0, "domain" : sDomain, "declaration" : 1, "group" : "shopify" },
                { "src" : "doubleclick.net","cookie" : "_shopify_fs","provider" : "shopify.com","description" : "","expires" : 0,"domain" : sDomain,"declaration" : 1,"group" : "shopify" },
                { "src" : "trekkie", "cookie" : "_shopify_fs", "provider" : "shopify.com", "description" : "", "expires" : 0, "domain" : sDomain, "declaration" : 1, "group" : "shopify" },
                { "src" : "luckyorange", "cookie" : "_shopify_fs", "provider" : "shopify.com", "description" : "", "expires" : 0, "domain" : sDomain, "declaration" : 1, "group" : "shopify" },
                { "src" : "googletagmanager", "cookie" : "_gat", "provider" : "googletagmanager.com", "description" : "", "expires" : 0, "domain" : sDomain, "declaration" : 1, "group" : "googletagmanager" }
            );

            {% comment %}
            /**************************** start custom section *******************************/

            // Declaration of the cookie to be listened to

            /* example start

            var customCookies = {
               "myCookie" : true,
               "myOtherCookie" : true
            };

            example end */
            {% endcomment %}

            var customCookies = {};

            function BC_GDPR_CustomScriptForShop () {
                return [

                    function testCookie () {
                        // your additional script
                    }

                    {% comment %}
                    /* example start

                    --------------------------------------------
                    **************   define function   **************

                    **************   the name of the function is the cookie name   **************
                    **************   Important, the use of commas as separators    **************

                    function myCookie () {
                        your additional code
                    },

                    function myOtherCookie () {
                        your additional code
                    }

                    --------------------------------------------
                    example end */

                    /**************************** End custom section *******************************/
                    {% endcomment %}
                ];
            }

        </script>
    {% endif %}
{% endunless %}
